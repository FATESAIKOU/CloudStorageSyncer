# Web Interface - Overview System Interface

## 完整系統架構層次

```mermaid
graph TD
    subgraph "Frontend"
        WebUI[Web UI Module]
        Router[Router Module]
        State[State Management]
        Auth[Auth Module]
    end

    subgraph "Backend"
        APIGateway[API Gateway]
        BusinessLogic[Business Logic]
        Repository[Repository Layer]
    end

    subgraph "Core"
        CoreServices[Core Services]
        S3Service[S3 Service]
        ConfigService[Config Service]
    end

    WebUI --> APIGateway
    Router --> APIGateway
    State --> APIGateway
    Auth --> APIGateway

    APIGateway --> BusinessLogic
    BusinessLogic --> Repository
    Repository --> CoreServices
    CoreServices --> S3Service
    CoreServices --> ConfigService
```

## 介面規範定義

### Frontend -> Backend API

```mermaid
classDiagram
    class AuthAPI {
        +POST /auth/login(username, password): AuthResult
        +POST /auth/logout(): void
        +GET /auth/verify(): AuthStatus
    }

    class FileAPI {
        +POST /files/upload: UploadResult
        +GET /files/list?prefix=string: FileListResult
        +GET /files/download/:key: FileStream
        +DELETE /files/:key: DeleteResult
        +GET /files/search?pattern=string: SearchResult
    }

    class ConfigAPI {
        +GET /config: ConfigResult
        +POST /config: ConfigUpdateResult
        +GET /config/test: TestResult
    }
```

### Backend -> Core Interface

```mermaid
classDiagram
    class IFileRepository {
        +uploadFile(request): UploadResult
        +downloadFile(request): DownloadResult
        +listFiles(request): FileListResult
        +deleteFile(request): DeleteResult
        +searchFiles(request): SearchResult
    }

    class IConfigRepository {
        +getConfig(): ConfigResult
        +updateConfig(config): ConfigResult
        +testConnection(): TestResult
    }
```

## 各模組時序圖

### 1. 登入頁面

```mermaid
sequenceDiagram
    participant F as Frontend
    participant B as Backend
    participant C as Core

    F->>B: POST /auth/login
    B->>B: 驗證認證資訊
    B-->>F: AuthResult
    F->>F: 更新認證狀態
```

### 2. 上傳檔案

```mermaid
sequenceDiagram
    participant F as Frontend
    participant B as Backend
    participant C as Core

    F->>B: POST /files/upload
    B->>B: 業務邏輯驗證
    B->>C: Repository.uploadFile()
    C->>C: S3Service.upload()
    C-->>B: UploadResult
    B-->>F: UploadResult
    F->>F: 更新UI狀態
```

### 3. 檔案列表

```mermaid
sequenceDiagram
    participant F as Frontend
    participant B as Backend
    participant C as Core

    F->>B: GET /files/list
    B->>C: Repository.listFiles()
    C->>C: S3Service.listObjects()
    C-->>B: FileListResult
    B-->>F: FileListResult
    F->>F: 渲染檔案列表
```

### 4. 下載檔案

```mermaid
sequenceDiagram
    participant F as Frontend
    participant B as Backend
    participant C as Core

    F->>B: GET /files/download/:key
    B->>C: Repository.downloadFile()
    C->>C: S3Service.download()
    C-->>B: FileStream
    B-->>F: FileStream
    F->>F: 觸發檔案下載
```

### 5. 刪除檔案

```mermaid
sequenceDiagram
    participant F as Frontend
    participant B as Backend
    participant C as Core

    F->>B: DELETE /files/:key
    B->>B: 驗證刪除權限
    B->>C: Repository.deleteFile()
    C->>C: S3Service.delete()
    C-->>B: DeleteResult
    B-->>F: DeleteResult
    F->>F: 更新檔案列表
```

### 6. 搜尋檔案

```mermaid
sequenceDiagram
    participant F as Frontend
    participant B as Backend
    participant C as Core

    F->>B: GET /files/search?pattern=xxx
    B->>B: 驗證搜尋參數
    B->>C: Repository.searchFiles()
    C->>C: S3Service.search()
    C-->>B: SearchResult
    B-->>F: SearchResult
    F->>F: 渲染搜尋結果
```

### 7. 配置管理

```mermaid
sequenceDiagram
    participant F as Frontend
    participant B as Backend
    participant C as Core

    F->>B: GET /config
    B->>C: Repository.getConfig()
    C->>C: ConfigService.load()
    C-->>B: ConfigResult
    B-->>F: ConfigResult
    F->>F: 渲染配置表單

    Note over F,C: 更新配置流程
    F->>B: POST /config
    B->>C: Repository.updateConfig()
    C->>C: ConfigService.save()
    C-->>B: ConfigUpdateResult
    B-->>F: ConfigUpdateResult
    F->>F: 更新配置狀態
```
