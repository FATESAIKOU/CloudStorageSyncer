# File Upload Feature Process Flow Design

## 1. Simplified Process Overview

```plantuml
@startuml
!theme plain

start
:User executes CLI command;
:Parse file path and parameters;
:Load S3 configuration via ConfigService;

if (Configuration complete?) then (Yes)
  :Check file existence;
  if (File exists?) then (Yes)
    :Create S3Service with config;
    :Test S3 connection if needed;
    if (Connection OK?) then (Yes)
      :Execute file upload via S3Service;
      :Display success message with S3 URL;
    else (No)
      :Display connection error;
    endif
  else (No)
    :Display file not found error;
  endif
else (No)
  :Display incomplete configuration error;
endif

stop
@enduml
```

## 2. Configuration Management Process

```plantuml
@startuml
!theme plain

start
:User sets configuration;

if (Configuration valid?) then (Yes)
  :Test S3 connection (optional);
  if (Connection test required and failed?) then (Yes)
    :Display connection error;
    :Ask user to retry or skip test;
  else (No or Success)
    :Save configuration via ConfigService;
    :Set file permissions to 0o600;
    :Display success message;
  endif
else (No)
  :Display invalid configuration error;
endif

stop
@enduml
```

## 3. CLI Command Structure Design

### 3.1 Configuration Commands
```bash
# Interactive setup
cloud-storage-syncer config setup

# Show current configuration
cloud-storage-syncer config show

# Test S3 connection
cloud-storage-syncer config test

# Remove configuration
cloud-storage-syncer config remove
```

### 3.2 Upload Commands
```bash
# Upload single file
cloud-storage-syncer upload file /path/to/file.txt

# Upload with custom S3 key and storage class
cloud-storage-syncer upload file /path/to/file.txt \
  --s3-key "uploads/file.txt" \
  --storage-class STANDARD_IA

# Upload directory
cloud-storage-syncer upload directory /path/to/dir --recursive

# Upload directory with prefix
cloud-storage-syncer upload directory /path/to/dir \
  --prefix "backup/2024" \
  --recursive

# Batch upload from file list
cloud-storage-syncer upload batch /path/to/filelist.txt
```

## 4. Upload Process Flow

```plantuml
@startuml
!theme plain

participant "CLI" as cli
participant "ConfigService" as config
participant "S3Service" as s3
participant "AWS S3" as aws

cli -> config: load_config()
config -> cli: S3Config

alt Configuration exists and valid
  cli -> s3: new S3Service(config)
  cli -> s3: upload_file(UploadRequest)

  s3 -> s3: validate file exists
  s3 -> s3: test_connection() if needed
  s3 -> aws: upload_file()
  aws -> s3: success/error
  s3 -> cli: UploadResult

  alt Upload successful
    cli -> cli: display success message
  else Upload failed
    cli -> cli: display error message
  end

else Configuration missing/invalid
  cli -> cli: display config error
  cli -> cli: suggest running config setup
end

@enduml
```

## 4. 基本錯誤處理

簡單的錯誤處理策略：
- 檔案不存在 → 顯示錯誤訊息
- 配置不完整 → 提示設定配置
- S3 操作失敗 → 顯示 boto3 原始錯誤
- 網路問題 → 顯示連接錯誤
